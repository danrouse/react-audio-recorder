var AudioRecorder=function(t){var e={};function o(n){if(e[n])return e[n].exports;var a=e[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,o),a.l=!0,a.exports}return o.m=t,o.c=e,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)o.d(n,a,function(e){return t[e]}.bind(null,a));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=1)}([function(t,e){t.exports=React},function(t,e,o){"use strict";o.r(e);var n=o(0);function a(t,e,o){for(var n=0;n<o.length;n++)t.setUint8(e+n,o.charCodeAt(n))}function i(t,e){for(var o=new Float64Array(e),n=0,a=0;a<t.length;a++){var i=t[a];o.set(i,n),n+=i.length}return o}function r(t,e,o,n){void 0===n&&(n=1);var r=function(t,e){for(var o=t.length+e.length,n=new Float64Array(o),a=0,i=0;i<o;)n[i++]=t[a],n[i++]=e[a],a++;return n}(i(t[0],e),i(t[1],e)),s=new ArrayBuffer(44+2*r.length),c=new DataView(s);return a(c,0,"RIFF"),c.setUint32(4,44+2*r.length,!0),a(c,8,"WAVE"),a(c,12,"fmt "),c.setUint32(16,16,!0),c.setUint16(20,1,!0),c.setUint16(22,2,!0),c.setUint32(24,o,!0),c.setUint32(28,4*o,!0),c.setUint16(32,4,!0),c.setUint16(34,16,!0),a(c,36,"data"),c.setUint32(40,2*r.length,!0),r.forEach(function(t,e){c.setInt16(44+2*e,t*(32767*n),!0)}),new Blob([c],{type:"audio/wav"})}var s=navigator.mediaDevices?navigator.mediaDevices.getUserMedia:navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,c=AudioContext||webkitAudioContext,u=function(){function t(){this.recordingNodes=[]}return Object.defineProperty(t.prototype,"bufferLength",{get:function(){return this.buffers[0].length*t.bufferSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"audioDuration",{get:function(){return this.bufferLength/t.audioContext.sampleRate},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"audioData",{get:function(){return this.encodingCache||r(this.buffers,this.bufferLength,t.audioContext.sampleRate)},enumerable:!0,configurable:!0}),t.prototype.startRecording=function(){var e=this;return new Promise(function(o,n){s({audio:!0},function(n){var a=t.audioContext,i=a.createGain(),r=a.createMediaStreamSource(n),s=a.createScriptProcessor(t.bufferSize,2,2);e.encodingCache&&(e.encodingCache=null),s.onaudioprocess=function(t){e.encodingCache&&(e.encodingCache=null);for(var o=0;o<2;o++){var n=t.inputBuffer.getChannelData(o);e.buffers[o].push(new Float32Array(n))}},r.connect(i),i.connect(s),s.connect(a.destination),e.recordingStream=n,e.recordingNodes.push(r,i,s),o(n)},function(t){n(t)})})},t.prototype.stopRecording=function(){for(var t in this.recordingStream&&(this.recordingStream.getTracks()[0].stop(),delete this.recordingStream),this.recordingNodes)this.recordingNodes[t].disconnect(),delete this.recordingNodes[t]},t.prototype.startPlayback=function(e,o){var n=this;return void 0===e&&(e=!1),new Promise(function(a,i){var r=new FileReader;r.readAsArrayBuffer(n.audioData),r.onloadend=function(){t.audioContext.decodeAudioData(r.result,function(i){var r=t.audioContext.createBufferSource();r.buffer=i,r.connect(t.audioContext.destination),r.loop=e,r.start(0),r.onended=o,n.playbackNode=r,a(r)})}})},t.prototype.stopPlayback=function(){this.playbackNode.stop()},t.prototype.reset=function(){this.playbackNode&&(this.playbackNode.stop(),this.playbackNode.disconnect(0),delete this.playbackNode),this.stopRecording(),this.buffers=[[],[]]},t.audioContext=new c,t.bufferSize=2048,t}();var d,l=(d=function(t,e){return(d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}d(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.waveInterface=new u,e.state={isRecording:!1,isPlaying:!1,audioData:e.props.initialAudio},e.onAudioEnded=function(){e.setState({isPlaying:!1}),e.props.onEnded&&e.props.onEnded()},e.onRemoveClick=function(){e.waveInterface.reset(),e.state.audioData&&e.props.onChange&&e.props.onChange({duration:0,audioData:null}),e.setState({isPlaying:!1,isRecording:!1,audioData:null})},e.onDownloadClick=function(){return function(t,e){var o=window.URL.createObjectURL(t),n=document.createEvent("Event");n.initEvent("click",!0,!0);var a=document.createElement("A");return a.href=o,a.download=e,a.dispatchEvent(n),a.click(),a}(e.state.audioData,e.props.filename)},e.onButtonClick=function(t){e.state.audioData?e.state.isPlaying?(e.stopPlayback(),t.preventDefault()):e.startPlayback():e.state.isRecording?e.stopRecording():e.startRecording()},e}return l(e,t),e.prototype.componentWillReceiveProps=function(t){t.initialAudio&&t.initialAudio!==this.props.initialAudio&&this.state.audioData&&t.initialAudio!==this.state.audioData&&(this.waveInterface.reset(),this.setState({audioData:t.initialAudio,isPlaying:!1,isRecording:!1}))},e.prototype.componentWillMount=function(){this.waveInterface.reset()},e.prototype.componentWillUnmount=function(){this.waveInterface.reset()},e.prototype.startRecording=function(){var t=this;this.state.isRecording||this.waveInterface.startRecording().then(function(){t.setState({isRecording:!0}),t.props.onRecordStart&&t.props.onRecordStart()}).catch(function(t){throw t})},e.prototype.stopRecording=function(){this.waveInterface.stopRecording(),this.setState({isRecording:!1,audioData:this.waveInterface.audioData}),this.props.onChange&&this.props.onChange({duration:this.waveInterface.audioDuration,audioData:this.waveInterface.audioData})},e.prototype.startPlayback=function(){var t=this;this.state.isPlaying||this.waveInterface.startPlayback(this.props.loop,this.onAudioEnded).then(function(){t.setState({isPlaying:!0}),t.props.onPlay&&t.props.onPlay()})},e.prototype.stopPlayback=function(){this.waveInterface.stopPlayback(),this.setState({isPlaying:!1}),this.props.onAbort&&this.props.onAbort()},e.prototype.render=function(){return n.createElement("div",{className:"AudioRecorder"},n.createElement("button",{className:["AudioRecorder-button",this.state.audioData?"hasAudio":"",this.state.isPlaying?"isPlaying":"",this.state.isRecording?"isRecording":""].join(" "),onClick:this.onButtonClick},this.state.audioData&&!this.state.isPlaying&&this.props.playLabel,this.state.audioData&&this.state.isPlaying&&this.props.playingLabel,!this.state.audioData&&!this.state.isRecording&&this.props.recordLabel,!this.state.audioData&&this.state.isRecording&&this.props.recordingLabel),this.state.audioData&&n.createElement("button",{className:"AudioRecorder-remove",onClick:this.onRemoveClick},this.props.removeLabel),this.state.audioData&&this.props.downloadable&&n.createElement("button",{className:"AudioRecorder-download",onClick:this.onDownloadClick},this.props.downloadLabel))},e.defaultProps={loop:!1,downloadable:!0,className:"",style:{},filename:"output.wav",playLabel:"🔊 Play",playingLabel:"❚❚ Playing",recordLabel:"● Record",recordingLabel:"● Recording",removeLabel:"✖ Remove",downloadLabel:"💾 Save"},e}(n.Component);e.default=p}]);